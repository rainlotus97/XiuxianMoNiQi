var L=Object.defineProperty;var H=(n,o,s)=>o in n?L(n,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[o]=s;var a=(n,o,s)=>H(n,typeof o!="symbol"?o+"":o,s);import{d as A,a as p,c as I,b as E,n as M,e as f,t as R,o as D,r as N,f as O,g as K,F as U,h as m,u as h}from"./index-BHLpPCy7.js";const c=(n,o=0)=>Math.max(n,o),v=["#2ad41a","#04aef8","#f780c6"],b=["#410a0a","#3f3f3d","#abbbb9"];class y{constructor(){a(this,"HP",100);a(this,"MP",50);a(this,"ATK",20);a(this,"M_ATK",15);a(this,"DEF",10);a(this,"M_DEF",8);a(this,"PEN","0%");a(this,"M_PEN","0%");a(this,"SPD",15);a(this,"CRIT_RATE","5%");a(this,"CRIT_DMG","150%");a(this,"DODGE","3%");a(this,"HIT","90%");a(this,"RESIST",{de_dizziness:"5%",de_poisoned:"0%"})}}var d=(n=>(n[n.NORMAL_ATTACK=0]="NORMAL_ATTACK",n[n.PHYSICAL_ATTACK=1]="PHYSICAL_ATTACK",n[n.MAGIC_ATTACK=2]="MAGIC_ATTACK",n))(d||{}),l=(n=>(n.DIZZINESS="de_dizziness",n.POISONED="de_poisoned",n))(l||{}),P=(n=>(n.PLAYER="player",n.MONSTER="monster",n.PET="pet",n))(P||{});class C extends y{constructor(s,t,e=1,i="secret",r=0){super();a(this,"NAME","");a(this,"AGE",1);a(this,"SEX","secret");a(this,"IDENTITY");a(this,"EXP",0);a(this,"CURRENT_HP",this.HP);a(this,"CURRENT_MP",this.MP);a(this,"LEVEL",0);a(this,"STATE_LIST",new Set);a(this,"EFFECT_MAP",new Map);a(this,"ADDITION_PERPORTY",new Map);this.NAME=s,this.AGE=e,this.IDENTITY=t,this.SEX=i,this.EXP=r,this.initData()}initData(){this.LEVEL=this.getLevel(),this.HP=Math.floor(this.HP+this.LEVEL*50),this.CURRENT_HP=this.HP,this.MP=Math.floor(this.MP+this.LEVEL*10),this.CURRENT_MP=this.MP,this.ATK=Math.floor(this.ATK+this.LEVEL*3),this.M_ATK=Math.floor(this.M_ATK+this.LEVEL*2),this.DEF=Math.floor(this.DEF+this.LEVEL*3),this.M_DEF=Math.floor(this.M_DEF+this.LEVEL*2),this.SPD=Math.floor(this.SPD+this.LEVEL*2),this.CRIT_RATE=Math.floor(Math.max(this.ATK,this.M_ATK)/100)+parseFloat(this.CRIT_RATE)+"%",this.CRIT_DMG=Math.floor(Math.max(this.ATK,this.M_ATK)/100*2.5)+parseFloat(this.CRIT_DMG)+"%"}useAdditionEffect(s,t){this.ADDITION_PERPORTY.has(s)&&this.deleteAdditionEffect(s),this.ADDITION_PERPORTY.set(s,t),this.deployStatus(t)}deleteAdditionEffect(s){let t=this.ADDITION_PERPORTY.get(s)||null;this.ADDITION_PERPORTY.has(s)&&this.ADDITION_PERPORTY.delete(s),t&&this.removeStatus(t)}clearAllAdditionEffect(){this.ADDITION_PERPORTY.forEach((s,t)=>{this.deleteAdditionEffect(t)})}getLevel(){return Math.floor(Math.pow(this.EXP/100,2/3))}isCritcal(){return Math.random()<=parseFloat(this.CRIT_RATE)/100}deleteEffect(s,t=!1){if(this.EFFECT_MAP.has(s)){const e=this.EFFECT_MAP.get(s);let r=new Date().getTime()-e.startTime>=e.duration;(t||r)&&(this.removeStatus(e.status),this.EFFECT_MAP.delete(s),this.STATE_LIST.delete(s),console.log(this.NAME,s+"效果已经清除"))}}useEffect(s){if(this.EFFECT_MAP.has(s.state)){const t=this.EFFECT_MAP.get(s.state)||null;t&&this.deleteEffect(t.state,!0)}this.EFFECT_MAP.set(s.state,s),this.STATE_LIST.add(s.state),this.deployStatus(s.status),console.log(this.NAME,s.state.startsWith("de_")?"受到了debuff效果"+s.state:"获得了增益效果")}updateEffect(){if(!this.EFFECT_MAP.size){console.log("无需清理异常状态数据");return}this.EFFECT_MAP.forEach(s=>{this.deleteEffect(s.state)})}deployStatus(s){Object.entries(s).forEach(([t,e])=>{const i=t;if(t in this)if(typeof e=="number")this[i]=c(Math.floor(this[i]+e));else if(typeof e=="string"){const r=parseFloat(this[i]);this[i]=c(Math.floor(r+parseFloat(e)))+"%"}else{let r=this[i];r[l.DIZZINESS]=c(Math.floor(parseFloat(r[l.DIZZINESS])+parseFloat(e[l.DIZZINESS])))+"%",r[l.POISONED]=c(Math.floor(parseFloat(r[l.POISONED])+parseFloat(e[l.POISONED])))+"%"}})}removeStatus(s){Object.entries(s).forEach(([t,e])=>{const i=t;if(t in this)if(typeof e=="number")this[i]=c(Math.floor(this[i]-e));else if(typeof e=="string"){const r=parseFloat(this[i]);this[i]=c(Math.floor(r-parseFloat(e)))+"%"}else{let r=this[i];r[l.DIZZINESS]=c(Math.floor(parseFloat(r[l.DIZZINESS])-parseFloat(e[l.DIZZINESS])))+"%",r[l.POISONED]=c(Math.floor(parseFloat(r[l.POISONED])-parseFloat(e[l.POISONED])))+"%"}})}getPhysicalDemage(s,t=1){const e=this.ATK+s*(1-parseFloat(this.PEN)/100);return e?c(Math.round(t*(this.ATK*(this.ATK/e))*(this.isCritcal()?parseFloat(this.CRIT_DMG)/100:1))):0}getMagicDemage(s,t=1){return this.M_ATK+s*(1-parseFloat(this.M_PEN)/100)?c(Math.round(t*(this.M_ATK*(this.M_ATK/(this.M_ATK+s*(1-parseFloat(this.M_PEN)/100))))*(this.isCritcal()?parseFloat(this.CRIT_DMG)/100:1))):0}getFinalDenfence(s=d.NORMAL_ATTACK){let t=0;return s===d.MAGIC_ATTACK?t=this.M_DEF:t=this.DEF,c(t)}isHitEnemy(s){const t=parseFloat(this.HIT)-parseFloat(s);return Math.random()<t/100}isHitEffect(s,t,e="0%"){const i=s[t],r=parseFloat(this.HIT)+parseFloat(e)-parseFloat(i);return Math.random()<r/100}}class Z{constructor(o,s=1e3){a(this,"animationId",null);a(this,"lastTime",0);a(this,"interval");a(this,"callback");a(this,"isRunning",!1);a(this,"loop",o=>{var s;this.isRunning&&(o-this.lastTime>=this.interval&&((s=this.callback)==null||s.call(this),this.lastTime=o),this.animationId=requestAnimationFrame(this.loop))});this.callback=o,this.interval=s}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationId=requestAnimationFrame(this.loop))}pause(){this.isRunning&&(this.isRunning=!1,this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null))}resume(){this.isRunning||(this.isRunning=!0,this.animationId=requestAnimationFrame(this.loop))}end(){this.pause(),this.callback=null}}const V={class:"person_view"},Y={class:"main_mp flex_start"},F=A({__name:"Person",props:{identity:{},name:{},currentHP:{},MaxHP:{},currentMP:{},MaxMP:{},isLTR:{type:Boolean}},setup(n){const o=n,s=p(()=>o.identity===P.PLAYER?v[0]:b[0]),t=p(()=>o.MaxHP?o.currentHP/o.MaxHP*100:0),e=p(()=>o.MaxMP?o.currentMP/o.MaxMP*100:0);return(i,r)=>(D(),I("div",V,[E("div",{class:f(["icon_area",{pos_left:i.isLTR,pos_right:!i.isLTR}]),style:M({backgroundColor:s.value})},R(i.name),7),E("div",{class:f(["p_area",{pos_left:!i.isLTR,pos_right:i.isLTR}])},[E("div",{class:f(["main_hp flex_start",{flex_end:!i.isLTR,flex_start:i.isLTR}])},[E("div",{class:"current_hp",style:M({width:t.value+"%"})},null,4),E("div",{class:f(["hp_text",{pos_right:!i.isLTR,pos_left:i.isLTR,pr20:!i.isLTR,pl20:i.isLTR}])},R(`${i.currentHP} / ${i.MaxHP}`),3)],2),E("div",Y,[E("div",{class:"current_mp",style:M({width:e.value+"%"})},null,4),E("div",{class:f(["mp_text",{pos_right:!i.isLTR,pos_left:i.isLTR,pr20:!i.isLTR,pl20:i.isLTR}])},R(`${i.currentMP} / ${i.MaxMP}`),3)])],2)]))}}),w={class:"game_container"},G=A({__name:"Combat",setup(n){let o=new C("陈平安",P.PLAYER),s=new C("荒天帝",P.MONSTER),t=N(o),e=N(s);const i=()=>{t.CURRENT_HP=t.HP,t.CURRENT_MP=t.MP,e.ATK=15+Math.random()*10,e.CURRENT_HP=e.HP,e.CURRENT_MP=e.MP},r=()=>{if(!t.CURRENT_HP||!e.CURRENT_HP){e.CURRENT_HP?(t.EXP-=10,console.log("怪物获得了胜利,并损失经验10点,当前经验值为:",t.EXP)):(t.EXP+=10,console.log("修仙者获得了胜利,并获得经验10点,当前经验值为:",t.EXP)),i();return}if(t.CURRENT_HP>0){if(!t.isHitEnemy(e.DODGE)){console.log("敌人进行了闪避");return}if(t.isHitEffect(e.RESIST,l.DIZZINESS)){const _={startTime:new Date().getTime(),duration:2e3,state:l.DIZZINESS,status:{ATK:-2,DEF:-2}};e.useEffect(_)}const T=t.getPhysicalDemage((e==null?void 0:e.getFinalDenfence())||0);console.log(`修仙者发起了攻击,造成了${T}点伤害`),e.CURRENT_HP=e.CURRENT_HP-T>0?Math.floor(e.CURRENT_HP-T):0}if(e.CURRENT_HP>0){if(!e.isHitEnemy(t.DODGE)){console.log("修仙者进行了闪避");return}if(e.isHitEffect(t.RESIST,l.POISONED)){const _={startTime:new Date().getTime(),duration:2e3,state:l.POISONED,status:{ATK:-2}};t.useEffect(_)}const T=e.getPhysicalDemage((t==null?void 0:t.getFinalDenfence())||0);console.log(`怪物发起了攻击,造成了${T}点伤害`),t.CURRENT_HP=t.CURRENT_HP-T>0?Math.floor(t.CURRENT_HP-T):0}t.updateEffect(),e.updateEffect()};let u=new Z(r,1e3);O(()=>{u.start(),i()}),K(()=>{u.end()});const S=()=>{u.pause()},g=()=>{u.resume()};return(T,_)=>(D(),I(U,null,[E("div",w,[m(F,{name:h(t).NAME,identity:h(t).IDENTITY,"current-h-p":h(t).CURRENT_HP,"-max-h-p":h(t).HP,"current-m-p":h(t).CURRENT_MP,"-max-m-p":h(t).MP},null,8,["name","identity","current-h-p","-max-h-p","current-m-p","-max-m-p"]),m(F,{name:h(e).NAME,identity:h(e).IDENTITY,"current-h-p":h(e).CURRENT_HP,"-max-h-p":h(e).HP,"current-m-p":h(e).CURRENT_MP,"-max-m-p":h(e).MP,"is-l-t-r":!0},null,8,["name","identity","current-h-p","-max-h-p","current-m-p","-max-m-p"])]),E("div",{class:"box",style:{display:"flex","justify-content":"space-evenly"}},[E("button",{class:"cancel",onClick:S},"暂停战斗"),E("button",{class:"start",onClick:g},"恢复战斗")])],64))}}),x={class:"main_page"},z=A({__name:"CultivationView",setup(n){return(o,s)=>(D(),I("div",x,[m(G)]))}});export{z as default};
