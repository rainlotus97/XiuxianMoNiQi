var et=Object.defineProperty;var st=(a,e,t)=>e in a?et(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>st(a,typeof e!="symbol"?e+"":e,t);import{r as Y,d as G,a as y,c as g,b as M,n as K,e as S,t as H,o as A,f as at,w as nt,F as k,g as V,u as O,h as rt,i as it,j as ot,k as lt,l as ct,m as w}from"./index-C1yAPaSp.js";const b=(a,e=0)=>Math.max(a,e),q=["#2ad41a","#04aef8","#f780c6"],W=["#410a0a","#3f3f3d","#abbbb9"];function f(a,e){return`<span class="log-${e}">${a}</span>`}var Q=(a=>(a.de_dizziness="眩晕",a.de_poisoned="中毒",a.strengthen="强化",a))(Q||{});function v(a){return`<span class="log-${a.startsWith("de_")?"de_":""}buff">${Q[a]}</span>`}const R=class R{static attack(e){const t=`${f(e.actor.NAME,e.actor.IDENTITY)} 使用了${f("普通攻击","system")}，${f(e.target.NAME,e.target.IDENTITY)} 受到了 ${f(`${e.demage}点伤害`,"system")}。`;R.LOG_LIST.push(t)}static skillAttack(e){const t=`${f(e.actor.NAME,e.actor.IDENTITY)} 使用了技能 ${f(e.skillName,"system")}，对 ${f(e.target.NAME,e.target.IDENTITY)} 造成了 ${f(`${e.demage}点伤害`,"system")}。`;R.LOG_LIST.push(t)}static heal(e){const t=`${f(e.actor.NAME,e.actor.IDENTITY)} 使用了 ${f(e.skillName,"system")}，${f(e.target.NAME,e.target.IDENTITY)} 恢复了 ${f(`${e.demage}点生命`,"system")}。`;R.LOG_LIST.push(t)}static defeated(e){const t=`${f(e.target.NAME,e.target.IDENTITY)} 被击败了！`;R.LOG_LIST.push(t)}static buffApplied(e){const t=`${f(e.actor.NAME,e.actor.IDENTITY)} 向 ${f(e.target.NAME,e.target.IDENTITY)} 施加了 ${v(e.effect)} 效果。`;R.LOG_LIST.push(t)}static buffAppliedFail(e){const t=`${f(e.actor.NAME,e.actor.IDENTITY)} 准备向 ${f(e.target.NAME,e.target.IDENTITY)} 施加 ${v(e.effect)} 效果，${f("却并没有成功","system")}。`;R.LOG_LIST.push(t)}static buffUpdate(e){const t=`${f(e.target.NAME,e.target.IDENTITY)} 产生了${f("新","primary")}的 ${v(e.effect)} 效果。`;R.LOG_LIST.push(t)}static buffStrenthen(e){const t=`${f(e.target.NAME,e.target.IDENTITY)} 的 ${v(e.effect)} 效果得到${f("叠加","danger")}。`;R.LOG_LIST.push(t)}static buffExpired(e){const t=`${f(e.target.NAME,e.target.IDENTITY)} 的 ${v(e.effect)} 效果已结束。`;R.LOG_LIST.push(t)}static system(e){const t=`<span class="log-system">${e}</span>`;R.LOG_LIST.push(t)}};c(R,"LOG_LIST",Y([]));let C=R;class ut{constructor(){c(this,"HP",100);c(this,"MP",50);c(this,"ATK",20);c(this,"M_ATK",15);c(this,"DEF",10);c(this,"M_DEF",8);c(this,"PEN","0%");c(this,"M_PEN","0%");c(this,"SPD",15);c(this,"CRIT_RATE","5%");c(this,"CRIT_DMG","150%");c(this,"DODGE","3%");c(this,"HIT","90%");c(this,"RESIST",{de_dizziness:"5%",de_poisoned:"5%"})}}const x=()=>({HP:0,MP:0,ATK:0,M_ATK:0,DEF:0,M_DEF:0,PEN:"0%",M_PEN:"0%",SPD:0,CRIT_RATE:"0%",CRIT_DMG:"0%",DODGE:"0%",HIT:"0%",RESIST:{de_dizziness:"0%",de_poisoned:"0%"}});var X=(a=>(a[a.NORMAL_ATTACK=0]="NORMAL_ATTACK",a[a.PHYSICAL_ATTACK=1]="PHYSICAL_ATTACK",a[a.MAGIC_ATTACK=2]="MAGIC_ATTACK",a))(X||{}),T=(a=>(a.DIZZINESS="de_dizziness",a.POISONED="de_poisoned",a.STRENGTHEN="strengthen",a))(T||{}),I=(a=>(a.PLAYER="player",a.MONSTER="monster",a.PET="pet",a))(I||{});class B extends ut{constructor(t,s,n=1,l="secret",r=0){super();c(this,"NAME","");c(this,"AGE",1);c(this,"SEX","secret");c(this,"IDENTITY");c(this,"EXP",0);c(this,"CURRENT_HP",this.HP);c(this,"CURRENT_MP",this.MP);c(this,"LEVEL",0);c(this,"EFFECT_MAP",new Map);c(this,"ADDITION_PERPORTY",new Map);c(this,"BUFF_EFFECT",x());c(this,"EXTRA_EFFECT",x());c(this,"ROUND_COUNT",0);this.NAME=t,this.AGE=n,this.IDENTITY=s,this.SEX=l,this.EXP=r,this.initData()}initData(){this.LEVEL=this.getLevel(),this.HP=Math.floor(this.HP+this.LEVEL*50),this.CURRENT_HP=this.HP,this.MP=Math.floor(this.MP+this.LEVEL*10),this.CURRENT_MP=this.MP,this.ATK=Math.floor(this.ATK+this.LEVEL*3),this.M_ATK=Math.floor(this.M_ATK+this.LEVEL*2),this.DEF=Math.floor(this.DEF+this.LEVEL*3),this.M_DEF=Math.floor(this.M_DEF+this.LEVEL*2),this.SPD=Math.floor(this.SPD+this.LEVEL*2),this.CRIT_RATE=Math.floor(Math.max(this.ATK,this.M_ATK)/100)+parseFloat(this.CRIT_RATE)+"%",this.CRIT_DMG=Math.floor(Math.max(this.ATK,this.M_ATK)/100*2.5)+parseFloat(this.CRIT_DMG)+"%"}getStringUnit(t){return b(Math.round(parseFloat(this[t])+parseFloat(this.BUFF_EFFECT[t]||"0%")+parseFloat(this.EXTRA_EFFECT[t]||"0%")))+"%"}getNumberUnit(t){return b(Math.round(this[t]+(this.BUFF_EFFECT[t]||0)+(this.EXTRA_EFFECT[t]||0)))}getResist(t){var s,n;return b(Math.round(parseFloat(this.RESIST[t])+parseFloat(((s=this.BUFF_EFFECT.RESIST)==null?void 0:s[t])||"0%")+parseFloat(((n=this.EXTRA_EFFECT.RESIST)==null?void 0:n[t])||"0%")))+"%"}getRoundCount(){return this.ROUND_COUNT}canAct(){return!!this.CURRENT_HP}updateIncomeInfo(t){this.EXP+=t.EXP,console.log(this.NAME+" exp: "+this.EXP),this.getLevel()!==this.LEVEL&&this.initData(),this.reset()}reset(){this.CURRENT_HP=this.getNumberUnit("HP"),this.CURRENT_MP=this.getNumberUnit("MP"),this.EFFECT_MAP.clear(),this.BUFF_EFFECT=x(),this.ROUND_COUNT=0}updateStatus(){this.ROUND_COUNT++,this.EFFECT_MAP.size&&this.EFFECT_MAP.forEach(t=>{this.deleteBuffEffect(t.state)})}useAdditionEffect(t,s){this.ADDITION_PERPORTY.has(t)&&this.deleteAdditionEffect(t),this.ADDITION_PERPORTY.set(t,s),this.deployStatus(s,this.EXTRA_EFFECT)}deleteAdditionEffect(t){let s=this.ADDITION_PERPORTY.get(t)||null;this.ADDITION_PERPORTY.has(t)&&this.ADDITION_PERPORTY.delete(t),s&&this.removeStatus(s,this.EXTRA_EFFECT)}clearAllAdditionEffect(){this.ADDITION_PERPORTY.forEach((t,s)=>{this.deleteAdditionEffect(s)})}getLevel(){return Math.floor(Math.pow(this.EXP/100,2/3))}isCritcal(){const t=this.getStringUnit("CRIT_RATE");return Math.random()<=parseFloat(t)/100}deleteBuffEffect(t,s=!1){if(this.EFFECT_MAP.has(t)){const n=this.EFFECT_MAP.get(t);let l=this.ROUND_COUNT-n.startCount>=n.roundCount;(s||l)&&(this.removeStatus(n.status,this.BUFF_EFFECT),this.EFFECT_MAP.delete(t))}}useBuffEffect(t){const s=this.EFFECT_MAP.get(t.state)||null,n=!s;return s&&!t.isOverlay?(this.deleteBuffEffect(s.state,!0),C.buffUpdate({target:this,effect:t.state})):s&&t.isOverlay&&(this.deployStatus(s.status,t.status),this.removeStatus(s.status,this.BUFF_EFFECT),C.buffStrenthen({target:this,effect:t.state})),this.EFFECT_MAP.set(t.state,t),this.deployStatus(t.status,this.BUFF_EFFECT),n}deployStatus(t,s){Object.entries(t).forEach(([n,l])=>{const r=n;if(n in s)if(typeof l=="number")s[r]=Math.floor(s[r]+l);else if(typeof l=="string"){const h=parseFloat(s[r]);s[r]=Math.floor(h+parseFloat(l))+"%"}else{let h=s[r],o=l;h[T.DIZZINESS]=Math.floor(parseFloat(h[T.DIZZINESS])+parseFloat(o[T.DIZZINESS]))+"%",h[T.POISONED]=Math.floor(parseFloat(h[T.POISONED])+parseFloat(o[T.POISONED]))+"%"}})}removeStatus(t,s){Object.entries(t).forEach(([n,l])=>{const r=n;if(n in s)if(typeof l=="number")s[r]=Math.floor(s[r]-l);else if(typeof l=="string"){const h=parseFloat(s[r]);s[r]=Math.floor(h-parseFloat(l))+"%"}else{let h=s[r],o=l;h[T.DIZZINESS]=Math.floor(parseFloat(h[T.DIZZINESS])-parseFloat(o[T.DIZZINESS]))+"%",h[T.POISONED]=Math.floor(parseFloat(h[T.POISONED])-parseFloat(o[T.POISONED]))+"%"}})}getPhysicalDemage(t,s=1){const n=this.getNumberUnit("ATK"),l=n+t*(1-parseFloat(this.PEN)/100);return l?b(Math.round(s*(n*(n/l))*(this.isCritcal()?parseFloat(this.CRIT_DMG)/100:1))):0}getMagicDemage(t,s=1){const n=this.getNumberUnit("M_ATK"),l=this.getStringUnit("M_PEN"),r=this.getStringUnit("CRIT_DMG");return n+t*(1-parseFloat(l)/100)?b(Math.round(s*(n*(n/(n+t*(1-parseFloat(l)/100))))*(this.isCritcal()?parseFloat(r)/100:1))):0}getFinalDenfence(t=X.NORMAL_ATTACK){let s=0;return t===X.MAGIC_ATTACK?s=this.getNumberUnit("M_DEF"):s=this.getNumberUnit("DEF"),b(s)}isHitEnemy(t){const s=parseFloat(this.getStringUnit("HIT"))-parseFloat(t);return Math.random()<s/100}isHitEffect(t,s="0%"){const n=parseFloat(this.getStringUnit("HIT"))+parseFloat(s),l=n-parseFloat(t);return Math.random()<l/n}}var Z=(a=>(a.SECRET="secret",a.MALE="male",a.FEMALE="female",a))(Z||{});const ht=a=>Math.round(100*a^1.5);class Et{constructor(e,t=1e3){c(this,"animationId",null);c(this,"lastTime",0);c(this,"interval");c(this,"callback");c(this,"isRunning",!1);c(this,"loop",e=>{var t;this.isRunning&&(e-this.lastTime>=this.interval&&((t=this.callback)==null||t.call(this),this.lastTime=e),this.animationId=requestAnimationFrame(this.loop))});this.callback=e,this.interval=t}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationId=requestAnimationFrame(this.loop))}pause(){this.isRunning&&(this.isRunning=!1,this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null))}resume(){this.isRunning||(this.isRunning=!0,this.animationId=requestAnimationFrame(this.loop))}end(){this.pause(),this.callback=null}}const ft={class:"person_view"},Tt={class:"main_mp flex_start"},J=G({__name:"Person",props:{identity:{},name:{},currentHP:{},maxHP:{},currentMP:{},maxMP:{},isLTR:{type:Boolean}},setup(a){const e=a,t=y(()=>e.name.length>3?e.name.slice(0,2)+"...":e.name),s=y(()=>e.identity===I.PLAYER?q[Math.round((q.length-1)*Math.random())]:W[Math.round((W.length-1)*Math.random())]),n=y(()=>e.maxHP?e.currentHP/e.maxHP*100:0),l=y(()=>e.maxMP?e.currentMP/e.maxMP*100:0);return(r,h)=>(A(),g("div",ft,[M("div",{class:S(["icon_area",{pos_left:r.isLTR,pos_right:!r.isLTR}]),style:K({backgroundColor:s.value})},H(t.value),7),M("div",{class:S(["p_area",{pos_left:!r.isLTR,pos_right:r.isLTR}])},[M("div",{class:S(["main_hp flex_start",{flex_end:!r.isLTR,flex_start:r.isLTR}])},[M("div",{class:"current_hp",style:K({width:n.value+"%"})},null,4),M("div",{class:S(["hp_text",{pos_right:!r.isLTR,pos_left:r.isLTR,pr20:!r.isLTR,pl20:r.isLTR}])},H(`${r.currentHP} / ${r.maxHP}`),3)],2),M("div",Tt,[M("div",{class:"current_mp",style:K({width:l.value+"%"})},null,4),M("div",{class:S(["mp_text",{pos_right:!r.isLTR,pos_left:r.isLTR,pr20:!r.isLTR,pl20:r.isLTR}])},H(`${r.currentMP} / ${r.maxMP}`),3)])],2)]))}}),P={ageBase:15,agePerLevel:3.5,ageRandomRange:.2,nameComponents:{prefixes:["幽冥","赤焰","噬魂","九幽","玄冰","血煞","混沌","天罡"],cores:["魔蛛","妖虎","鬼藤","骨龙","尸鹫","影狼","血鸦","毒蟾"],suffixes:["幼体","变异体","首领","残魂","化身"]},baseAttributes:{hp:100,attack:20,defense:10},growthRate:{hp:8.5,attack:3.2,defense:1.8},skillRules:{elementMap:{fire:["赤焰","炎","焚天"],ice:["玄冰","寒","霜冻"],poison:["噬魂","毒","腐化"]},typeSkills:{beast:["狂暴撕咬","兽王威压"],undead:["死灵复苏","腐毒侵蚀"],demon:["心魔蛊惑","九幽鬼火"],unknown:[]}},tierThresholds:{advanced:50}},dt=a=>{const e=m=>m[Math.floor(Math.random()*m.length)],t=()=>{const{prefixes:m,cores:u,suffixes:p}=P.nameComponents,L=a>60?e(p.slice(2)):a>30?p[1]:p[0],F=e(m),d=F.length===2&&Math.random()>.4?"·":"";return`${F}${d}${e(u)}${L}`},s=m=>{const u={...P.baseAttributes};return Object.keys(P.growthRate).forEach(p=>{u[p]+=Math.floor(a*P.growthRate[p])}),Object.entries(P.skillRules.elementMap).forEach(([p,L])=>{if(L.some(F=>m.includes(F)))switch(p){case"fire":u.attack*=1.2;break;case"ice":u.defense*=1.3;break;case"poison":u.hp*=1.15;break}}),u},n=m=>{var p;return((p=Object.entries({beast:["虎","狼","蛛"],undead:["尸","骨","鬼"],demon:["魔","煞","幽冥"],unknown:[]}).find(([L,F])=>F.some(d=>m.includes(d))))==null?void 0:p[0])||"unknown"},l=m=>{const u=[];Object.entries(P.skillRules.elementMap).forEach(([L,F])=>{F.some(d=>m.includes(d))&&u.push(`${L.toUpperCase()}系精通`)});const p=n(m);return u.push(...P.skillRules.typeSkills[p]),a>=P.tierThresholds.advanced&&u.push("元神出窍"),[...new Set(u)]},r=()=>{const m=P.ageBase+a*P.agePerLevel,u=1+(Math.random()*2-1)*P.ageRandomRange;return Math.floor(m*u)},h=()=>Math.random()>.6?Z.MALE:Z.FEMALE,o=t();return{name:o,level:a,age:r(),gender:h(),type:n(o),attributes:s(o),skills:l(o),description:`散发着${o.includes("幽冥")?"阴森鬼气":"狂暴灵气"}的修真界生物`}},U=class U{static generateEnemies(e,t){const s=U.countMap[t],n=U.scale[t],l=[];for(let r=0;r<s;r++){const h=dt(e),o=new B(h.name,I.MONSTER,h.age,h.gender,ht(h.level));o.ATK=Math.round(o.ATK*n),o.M_ATK=Math.round(o.M_ATK*n),o.HP=Math.round(o.HP*n),o.CURRENT_HP=Math.round(o.CURRENT_HP*n),o.MP=Math.round(o.MP*n),o.CURRENT_MP=Math.round(o.CURRENT_MP*n),o.DEF=Math.round(o.DEF*n),o.M_DEF=Math.round(o.M_DEF*n),o.SPD=Math.round((o.SPD-r)*n),o.CRIT_RATE=Math.round(parseFloat(o.CRIT_RATE)*n)+"%",o.CRIT_RATE=Math.round(parseFloat(o.CRIT_RATE)*n)+"%",l.push(o)}return l}};c(U,"countMap",{easy:2,normal:3,hard:4,boss:1}),c(U,"scale",{easy:.8,normal:1,hard:1.2,boss:2});let z=U;const pt=["innerHTML"],Mt=G({__name:"LogView",setup(a){const e=C.LOG_LIST,t=at(null);return nt(()=>e.length,async()=>{await rt(),t.value&&(t.value.scrollTop=t.value.scrollHeight)}),(s,n)=>(A(),g("div",{class:"log_view",ref_key:"container",ref:t},[(A(!0),g(k,null,V(O(e),(l,r)=>(A(),g("div",{class:"log_item",key:r,innerHTML:l},null,8,pt))),128))],512))}}),mt={class:"game_container"},_t={class:"attack_list"},Rt={class:"attack_list"},Nt={key:0,class:"box",style:{display:"flex","justify-content":"space-evenly"}},It=G({__name:"Combat",setup(a){const e=it();let t=Y([]),s=Y([]),n=[];const l=Y({}),r=()=>{n.forEach(d=>{d.reset()}),o=n.sort((d,N)=>N.SPD-d.SPD)},h=()=>{const d=t.every(_=>!_.CURRENT_HP),N=s.every(_=>!_.CURRENT_HP);if(d){t.forEach(_=>{if(_.IDENTITY===I.PLAYER){const i={EXP:-10};_.updateIncomeInfo(i)}}),r();return}if(N){t.forEach(_=>{if(_.IDENTITY===I.PLAYER){const i={EXP:Math.round(100*Math.random())};_.updateIncomeInfo(i)}}),r();return}const E=m();if(E&&E.canAct()){l[E.NAME]=E.IDENTITY===I.MONSTER?"attack":"counterattack";const i=(E.IDENTITY===I.MONSTER?t:s).filter(D=>D.CURRENT_HP).sort((D,$)=>D.CURRENT_HP-$.CURRENT_HP)[0];if(!E.isHitEnemy(i.getStringUnit("DODGE"))){console.log(`${E.NAME}发起了攻击，但被${i.NAME}成功闪避!`);return}if(Math.random()>.4)if(E.isHitEffect(i.getResist(T.POISONED))){const D={startCount:i.getRoundCount(),roundCount:2,state:T.POISONED,isOverlay:Math.random()>=.6,status:{DEF:-1,ATK:-1}};i.useBuffEffect(D)&&C.buffApplied({actor:E,target:i,effect:T.POISONED})}else C.buffAppliedFail({actor:E,target:i,effect:T.POISONED});else{const D={startCount:E.getRoundCount(),roundCount:2,state:T.STRENGTHEN,isOverlay:!0,status:{DEF:10,ATK:10}};let $=E.IDENTITY===I.MONSTER?s:t;const j=$[Math.round(Math.random()*($.length-1))];j.useBuffEffect(D)&&C.buffApplied({actor:E,target:j,effect:T.STRENGTHEN})}if(i){l[i.NAME]=E.IDENTITY===I.MONSTER?"hit":"hit-counter";const D=E.getPhysicalDemage((i==null?void 0:i.getFinalDenfence())||0);i.CURRENT_HP=b(Math.round(i.CURRENT_HP-D)),C.attack({actor:E,target:i,demage:D})}let tt=setTimeout(()=>{delete l[E.NAME],i&&delete l[i.NAME],clearTimeout(tt)},i?500:400);E.updateStatus()}};let o;const m=()=>{if(o.length){let d=!0;for(;d;){let N=o.shift();if(N&&(o.push(N),N.CURRENT_HP))return d=!1,N}return}};let u=null,p=new B("陈平安",I.PLAYER);ot(()=>{let d=new B("宠物甲",I.PET),N=new B("柳如烟",I.PLAYER);p.SPD+=5,d.SPD+=1,N.SPD+=3,t.push(p),t.push(d),t.push(N);let E=z.generateEnemies(0,"easy");s=E,n=[...t,...E],o=n.sort((_,i)=>i.SPD-_.SPD),u=new Et(h,550),u.start()}),lt(()=>{u==null||u.end()});const L=()=>{u==null||u.pause()},F=()=>{u==null||u.resume()};return(d,N)=>{var E,_;return A(),g(k,null,[M("span",null,H("已获得经验："+((E=O(t)[0])==null?void 0:E.EXP)),1),M("span",null,H(" 当前等级："+((_=O(t)[0])==null?void 0:_.LEVEL)),1),M("div",{class:S(["combat_view",{flex_row:O(e).mediaHelperType.gridColumns>4}])},[M("div",mt,[M("div",_t,[(A(!0),g(k,null,V(O(t),i=>(A(),g("div",{class:"attack_item",key:i.NAME},[w(J,{class:S(["unit-wrapper",l[i.NAME]]),name:i.NAME,identity:i.IDENTITY,"current-h-p":i.CURRENT_HP,"max-h-p":i.getNumberUnit("HP"),"current-m-p":i.CURRENT_MP,"max-m-p":i.getNumberUnit("MP")},null,8,["class","name","identity","current-h-p","max-h-p","current-m-p","max-m-p"])]))),128))]),M("div",Rt,[(A(!0),g(k,null,V(O(s),i=>(A(),g("div",{class:"attack_item",key:i.NAME},[w(J,{class:S(["unit-wrapper",l[i.NAME]]),name:i.NAME,identity:i.IDENTITY,"current-h-p":i.CURRENT_HP,"max-h-p":i.getNumberUnit("HP"),"current-m-p":i.CURRENT_MP,"max-m-p":i.getNumberUnit("MP"),"is-l-t-r":!0},null,8,["class","name","identity","current-h-p","max-h-p","current-m-p","max-m-p"])]))),128))])]),O(e).mediaHelperType.gridColumns===4?(A(),g("div",Nt,[M("button",{class:"cancel btn",onClick:L},"暂停战斗"),M("button",{class:"start btn",onClick:F},"恢复战斗")])):ct("",!0),w(Mt)],2)],64)}}}),Pt={class:"main_page"},Ct=G({__name:"CultivationView",setup(a){return(e,t)=>(A(),g("div",Pt,[w(It)]))}});export{Ct as default};
