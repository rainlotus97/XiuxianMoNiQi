var se=Object.defineProperty;var ne=(c,t,n)=>t in c?se(c,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[t]=n;var N=(c,t,n)=>ne(c,typeof t!="symbol"?t+"":t,n);import{f as F,p as K,m as V,S as y,a as G,P as x,g as ae,L,c as X,e as re,U as S,d as oe}from"./cryptTools-D7lBlo3U.js";import{d as O,a as A,c as T,b as d,n as $,e as C,t as H,o as v,r as z,w as ie,f as W,g as Q,h as I,F as U,i as j,u as D,T as le,j as ce,k as ue,v as de,l as me,m as pe,p as Y,q as he}from"./index-CguTvOgF.js";class fe{constructor(t,n=1e3){N(this,"animationId",null);N(this,"lastTime",0);N(this,"interval");N(this,"callback");N(this,"isRunning",!1);N(this,"loop",t=>{var n;this.isRunning&&(t-this.lastTime>=this.interval&&((n=this.callback)==null||n.call(this),this.lastTime=t),this.animationId=requestAnimationFrame(this.loop))});this.callback=t,this.interval=n}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationId=requestAnimationFrame(this.loop))}pause(){this.isRunning&&(this.isRunning=!1,this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null))}resume(){this.isRunning||(this.isRunning=!0,this.animationId=requestAnimationFrame(this.loop))}end(){this.pause(),this.callback=null}}const ge={class:"person_view"},Re={class:"main_mp flex_start"},J=O({__name:"Person",props:{identity:{},name:{},currentHP:{},maxHP:{},currentMP:{},maxMP:{},isLTR:{type:Boolean}},setup(c){const t=c,n=A(()=>{const e=F(t.currentHP),a=F(t.maxHP);return`${e} / ${a}`}),u=A(()=>{const e=F(t.currentMP),a=F(t.maxMP);return`${e} / ${a}`}),i=A(()=>t.name.length>3?t.name.slice(0,2)+"...":t.name),m=A(()=>t.identity===y.FRIENDLY?K[Math.round((K.length-1)*Math.random())]:V[Math.round((V.length-1)*Math.random())]),R=A(()=>t.maxHP?t.currentHP/t.maxHP*100:0),h=A(()=>t.maxMP?t.currentMP/t.maxMP*100:0);return(e,a)=>(v(),T("div",ge,[d("div",{class:C(["icon_area",{pos_left:e.isLTR,pos_right:!e.isLTR}]),style:$({backgroundColor:m.value})},H(i.value),7),d("div",{class:C(["p_area",{pos_left:!e.isLTR,pos_right:e.isLTR}])},[d("div",{class:C(["main_hp flex_start",{flex_end:!e.isLTR,flex_start:e.isLTR}])},[d("div",{class:"current_hp",style:$({width:R.value+"%"})},null,4),d("div",{class:C(["hp_text",{pos_right:!e.isLTR,pos_left:e.isLTR,pr20:!e.isLTR,pl20:e.isLTR}])},H(n.value),3)],2),d("div",Re,[d("div",{class:"current_mp",style:$({width:h.value+"%"})},null,4),d("div",{class:C(["mp_text",{pos_right:!e.isLTR,pos_left:e.isLTR,pr20:!e.isLTR,pl20:e.isLTR}])},H(u.value),3)])],2)]))}}),M={ageBase:15,agePerLevel:3.5,ageRandomRange:.2,nameComponents:{prefixes:["幽冥","赤焰","噬魂","九幽","玄冰","血煞","混沌","天罡"],cores:["魔蛛","妖虎","鬼藤","骨龙","尸鹫","影狼","血鸦","毒蟾"],suffixes:["幼体","变异体","首领","残魂","化身"]},baseAttributes:{hp:100,attack:20,defense:10},growthRate:{hp:8.5,attack:3.2,defense:1.8},skillRules:{elementMap:{fire:["赤焰","炎","焚天"],ice:["玄冰","寒","霜冻"],poison:["噬魂","毒","腐化"]},typeSkills:{beast:["狂暴撕咬","兽王威压"],undead:["死灵复苏","腐毒侵蚀"],demon:["心魔蛊惑","九幽鬼火"],unknown:[]}},tierThresholds:{advanced:50}},_e=c=>{const t=a=>a[Math.floor(Math.random()*a.length)],n=()=>{const{prefixes:a,cores:r,suffixes:l}=M.nameComponents,_=c>60?t(l.slice(2)):c>30?l[1]:l[0],E=t(a),k=E.length===2&&Math.random()>.4?"·":"";return`${E}${k}${t(r)}${_}`},u=a=>{const r={...M.baseAttributes};return Object.keys(M.growthRate).forEach(l=>{r[l]+=Math.floor(c*M.growthRate[l])}),Object.entries(M.skillRules.elementMap).forEach(([l,_])=>{if(_.some(E=>a.includes(E)))switch(l){case"fire":r.attack*=1.2;break;case"ice":r.defense*=1.3;break;case"poison":r.hp*=1.15;break}}),r},i=a=>{var l;return((l=Object.entries({beast:["虎","狼","蛛"],undead:["尸","骨","鬼"],demon:["魔","煞","幽冥"],unknown:[]}).find(([_,E])=>E.some(k=>a.includes(k))))==null?void 0:l[0])||"unknown"},m=a=>{const r=[];Object.entries(M.skillRules.elementMap).forEach(([_,E])=>{E.some(k=>a.includes(k))&&r.push(`${_.toUpperCase()}系精通`)});const l=i(a);return r.push(...M.skillRules.typeSkills[l]),c>=M.tierThresholds.advanced&&r.push("元神出窍"),[...new Set(r)]},R=()=>{const a=M.ageBase+c*M.agePerLevel,r=1+(Math.random()*2-1)*M.ageRandomRange;return Math.floor(a*r)},h=()=>Math.random()>.6?G.MALE:G.FEMALE,e=n();return{name:e,level:c,age:R(),gender:h(),type:i(e),attributes:u(e),skills:m(e),description:`散发着${e.includes("幽冥")?"阴森鬼气":"狂暴灵气"}的修真界生物`}},b=class b{static generateEnemies(t,n){const u=b.countMap[n],i=b.scale[n],m=[];for(let R=0;R<u;R++){const h=_e(t),e=new x(h.name,y.ENEMY,h.age,h.gender,ae(h.level));e.ATK=Math.round(e.ATK*i),e.M_ATK=Math.round(e.M_ATK*i),e.HP=Math.round(e.HP*i),e.CURRENT_HP=Math.round(e.CURRENT_HP*i),e.MP=Math.round(e.MP*i),e.CURRENT_MP=Math.round(e.CURRENT_MP*i),e.DEF=Math.round(e.DEF*i),e.M_DEF=Math.round(e.M_DEF*i),e.SPD=Math.round((e.SPD-R)*i),e.CRIT_RATE=Math.round(parseFloat(e.CRIT_RATE)*i)+"%",e.CRIT_RATE=Math.round(parseFloat(e.CRIT_RATE)*i)+"%",m.push(e)}return m}};N(b,"countMap",{easy:2,normal:3,hard:4,boss:1}),N(b,"scale",{easy:.8,normal:1,hard:1.2,boss:2});let B=b;const Ee={class:"log_view"},Me=["innerHTML"],Te=O({__name:"LogView",setup(c){const t=z(null),n=z(!0);let u=!1;const i=L.LOG_LIST;ie(i,()=>{n.value&&me(()=>{m()})});const m=()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)},R=(a=5)=>{if(!t.value)return!0;const{scrollTop:r,clientHeight:l,scrollHeight:_}=t.value;return _-(r+l)<a},h=()=>{u||(u=!0,requestAnimationFrame(()=>{n.value=R(),u=!1}))};W(()=>{var a;(a=t.value)==null||a.addEventListener("scroll",h)}),Q(()=>{var a;(a=t.value)==null||a.removeEventListener("scroll",h)});const e=()=>{const a=setTimeout(()=>{n.value=!0,m(),clearTimeout(a)},350)};return(a,r)=>(v(),T("div",Ee,[d("div",{ref_key:"scrollContainer",ref:t,class:"scroll-container"},[(v(!0),T(U,null,j(D(i),(l,_)=>(v(),T("div",{key:_,class:"message-item",innerHTML:l},null,8,Me))),128))],512),I(le,{name:"fade-slide"},{default:ce(()=>[ue(d("div",{class:"back-button",onClick:e}," ↓ 返回底部 ",512),[[de,!n.value]])]),_:1})]))}}),ve={class:"game_container"},Pe={class:"attack_list"},Ne={class:"attack_list"},ye={key:0,class:"box",style:{display:"flex","justify-content":"space-evenly"}},Le=O({__name:"Combat",setup(c){const t=pe();let n=Y([]),u=Y([]),i=[];const m=Y({}),R=()=>{let f=B.generateEnemies(l.getLevel(),"easy");u=f,n.forEach(p=>{p.reset()}),i=[...n,...f],e=i.sort((p,o)=>o.SPD-p.SPD)},h=()=>{const f=n.every(g=>!g.CURRENT_HP),p=u.every(g=>!g.CURRENT_HP);if(f){n.forEach(g=>{const s={EXP:-10};g.updateIncomeInfo(s)}),L.defeated({actor:u[0],target:n[0]}),R();return}if(p){n.forEach(g=>{const s={EXP:Math.round(100*Math.random())};g.updateIncomeInfo(s)}),L.defeated({target:u[0],actor:n[0]}),R();return}const o=a();if(o&&o.canAct()){m[o.NAME]=o.SLIDE===y.FRIENDLY?"attack":"counterattack";const s=(o.SLIDE===y.ENEMY?n:u).filter(P=>P.CURRENT_HP).sort((P,w)=>P.CURRENT_HP-w.CURRENT_HP)[0];if(!o.isHitEnemy(s.getStringUnit("DODGE"))){m[s.NAME]="miss",L.attackMiss({actor:o,target:s});return}if(Math.random()>.4)if(o.isHitEffect(s.getResist(S.POISONED))){const P={startCount:s.getRoundCount(),roundCount:2,state:S.POISONED,isOverlay:Math.random()>=.6,status:{DEF:-1,ATK:-1}};s.useBuffEffect(P)&&L.buffApplied({actor:o,target:s,effect:S.POISONED})}else L.buffAppliedFail({actor:o,target:s,effect:S.POISONED});else{const P={startCount:o.getRoundCount(),roundCount:2,state:S.STRENGTHEN,isOverlay:!0,status:{DEF:10,ATK:10}};let w=o.SLIDE===y.ENEMY?u:n;const q=w[Math.round(Math.random()*(w.length-1))];q.useBuffEffect(P)&&L.buffApplied({actor:o,target:q,effect:S.STRENGTHEN})}if(s){m[s.NAME]=o.SLIDE===y.FRIENDLY?"hit":"hit-counter";const P=o.getPhysicalDemage((s==null?void 0:s.getFinalDenfence())||0);s.CURRENT_HP=X(Math.round(s.CURRENT_HP-P)),L.attack({actor:o,target:s,demage:P})}let te=setTimeout(()=>{delete m[o.NAME],s&&delete m[s.NAME],clearTimeout(te)},s?500:400);o.updateStatus()}};let e;const a=()=>{if(e.length){let f=!0;for(;f;){let p=e.shift();if(p&&(e.push(p),p.CURRENT_HP))return f=!1,p}return}};let r=null,l=new x("陈平安",y.FRIENDLY);W(()=>{let f=new x("宠物甲",y.FRIENDLY),p=new x("柳如烟",y.FRIENDLY);l.SPD+=5,f.SPD+=1,p.SPD+=3,n.push(l),n.push(f),n.push(p);let o=B.generateEnemies(X(Math.round(l.getLevel()-2)),"easy");u=o,i=[...n,...o],e=i.sort((g,s)=>s.SPD-g.SPD),r=new fe(h,550),r.start()}),Q(()=>{r==null||r.end()});const _=()=>{r==null||r.pause(),k()};let E="";const k=async()=>{E=await re(JSON.stringify(l)),console.log(E)},Z=async()=>{let f=await oe(E);console.log(f)},ee=()=>{r==null||r.resume(),Z()};return(f,p)=>{var o,g;return v(),T(U,null,[d("span",null,H("已获得经验："+((o=D(n)[0])==null?void 0:o.EXP)),1),d("span",null,H(" 当前等级："+((g=D(n)[0])==null?void 0:g.LEVEL)),1),d("div",{class:C(["combat_view",{flex_row:D(t).mediaHelperType.gridColumns>4}])},[d("div",ve,[d("div",Pe,[(v(!0),T(U,null,j(D(n),s=>(v(),T("div",{class:"attack_item",key:s.NAME},[I(J,{class:C(["unit-wrapper",m[s.NAME]]),name:s.NAME,identity:s.SLIDE,"current-h-p":s.CURRENT_HP,"max-h-p":s.getNumberUnit("HP"),"current-m-p":s.CURRENT_MP,"max-m-p":s.getNumberUnit("MP")},null,8,["class","name","identity","current-h-p","max-h-p","current-m-p","max-m-p"])]))),128))]),d("div",Ne,[(v(!0),T(U,null,j(D(u),s=>(v(),T("div",{class:"attack_item",key:s.NAME},[I(J,{class:C(["unit-wrapper",m[s.NAME]]),name:s.NAME,identity:s.SLIDE,"current-h-p":s.CURRENT_HP,"max-h-p":s.getNumberUnit("HP"),"current-m-p":s.CURRENT_MP,"max-m-p":s.getNumberUnit("MP"),"is-l-t-r":!0},null,8,["class","name","identity","current-h-p","max-h-p","current-m-p","max-m-p"])]))),128))])]),D(t).mediaHelperType.gridColumns===4?(v(),T("div",ye,[d("div",{class:"cancel btn",onClick:_},"暂停战斗"),d("div",{class:"start btn",onClick:ee},"恢复战斗")])):he("",!0),I(Te)],2)],64)}}}),Ce={class:"main_page"},we=O({__name:"CultivationView",setup(c){return(t,n)=>(v(),T("div",Ce,[I(Le)]))}});export{we as default};
