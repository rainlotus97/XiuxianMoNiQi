var e=Object.defineProperty,t=(t,a,s)=>((t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s)(t,"symbol"!=typeof a?a+"":a,s);import{f as a,p as s,m as n,S as i,a as r,P as l,g as o,L as u,u as c,b as d,c as m,d as p,r as h,U as v}from"../js2/index-CZkX4d2b.js";import{j as f,d as E,q as R,x as g,A as M,C as T,z as _,B as P,r as y,w as N,E as b,Q as L,L as k,F as C,y as x,u as A,T as H,M as D,G as I,U as w,n as S,a as U,v as F}from"./@vue-CeZAqxcJ.js";import"./pinia-Btsh0Kkk.js";import"./vue-router-BhO-QLR9.js";import"./pako-__J333JV.js";import"./crypto-js-D2oSFZKS.js";import"./pinia-plugin-persistedstate-CuiE3Ez8.js";import"./destr-WfmzGWA8.js";import"./deep-pick-omit-DP_A4OSP.js";class j{constructor(e,a=1e3){t(this,"animationId",null),t(this,"lastTime",0),t(this,"interval"),t(this,"callback"),t(this,"isRunning",!1),t(this,"loop",(e=>{var t;this.isRunning&&(e-this.lastTime>=this.interval&&(null==(t=this.callback)||t.call(this),this.lastTime=e),this.animationId=requestAnimationFrame(this.loop))})),this.callback=e,this.interval=a}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationId=requestAnimationFrame(this.loop))}pause(){this.isRunning&&(this.isRunning=!1,null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null))}resume(){this.isRunning||(this.isRunning=!0,this.animationId=requestAnimationFrame(this.loop))}end(){this.pause(),this.callback=null}}const O={class:"person_view"},$={class:"main_mp flex_start"},B=f({__name:"Person",props:{identity:{},name:{},currentHP:{},maxHP:{},currentMP:{},maxMP:{},isLTR:{type:Boolean}},setup(e){const t=e,r=E((()=>`${a(t.currentHP)} / ${a(t.maxHP)}`)),l=E((()=>`${a(t.currentMP)} / ${a(t.maxMP)}`)),o=E((()=>t.name.length>3?t.name.slice(0,2)+"...":t.name)),u=E((()=>t.identity===i.FRIENDLY?s[Math.round((s.length-1)*Math.random())]:n[Math.round((n.length-1)*Math.random())])),c=E((()=>t.maxHP?t.currentHP/t.maxHP*100:0)),d=E((()=>t.maxMP?t.currentMP/t.maxMP*100:0));return(e,t)=>(g(),R("div",O,[M("div",{class:_(["icon_area",{pos_left:e.isLTR,pos_right:!e.isLTR}]),style:T({backgroundColor:u.value})},P(o.value),7),M("div",{class:_(["p_area",{pos_left:!e.isLTR,pos_right:e.isLTR}])},[M("div",{class:_(["main_hp flex_start",{flex_end:!e.isLTR,flex_start:e.isLTR}])},[M("div",{class:"current_hp",style:T({width:c.value+"%"})},null,4),M("div",{class:_(["hp_text",{pos_right:!e.isLTR,pos_left:e.isLTR,pr20:!e.isLTR,pl20:e.isLTR}])},P(r.value),3)],2),M("div",$,[M("div",{class:"current_mp",style:T({width:d.value+"%"})},null,4),M("div",{class:_(["mp_text",{pos_right:!e.isLTR,pos_left:e.isLTR,pr20:!e.isLTR,pl20:e.isLTR}])},P(l.value),3)])],2)]))}}),K={ageBase:15,agePerLevel:3.5,ageRandomRange:.2,nameComponents:{prefixes:["幽冥","赤焰","噬魂","九幽","玄冰","血煞","混沌","天罡"],cores:["魔蛛","妖虎","鬼藤","骨龙","尸鹫","影狼","血鸦","毒蟾"],suffixes:["幼体","变异体","首领","残魂","化身"]},baseAttributes:{hp:100,attack:20,defense:10},growthRate:{hp:8.5,attack:3.2,defense:1.8},skillRules:{elementMap:{fire:["赤焰","炎","焚天"],ice:["玄冰","寒","霜冻"],poison:["噬魂","毒","腐化"]},typeSkills:{beast:["狂暴撕咬","兽王威压"],undead:["死灵复苏","腐毒侵蚀"],demon:["心魔蛊惑","九幽鬼火"],unknown:[]}},tierThresholds:{advanced:50}},Y=e=>{const t=e=>e[Math.floor(Math.random()*e.length)],a=e=>{var t;return(null==(t=Object.entries({beast:["虎","狼","蛛"],undead:["尸","骨","鬼"],demon:["魔","煞","幽冥"],unknown:[]}).find((([t,a])=>a.some((t=>e.includes(t))))))?void 0:t[0])||"unknown"},s=(()=>{const{prefixes:a,cores:s,suffixes:n}=K.nameComponents,i=e>60?t(n.slice(2)):e>30?n[1]:n[0],r=t(a);return`${r}${2===r.length&&Math.random()>.4?"·":""}${t(s)}${i}`})();return{name:s,level:e,age:(()=>{const t=K.ageBase+e*K.agePerLevel,a=1+(2*Math.random()-1)*K.ageRandomRange;return Math.floor(t*a)})(),gender:Math.random()>.6?r.MALE:r.FEMALE,type:a(s),attributes:(t=>{const a={...K.baseAttributes};return Object.keys(K.growthRate).forEach((t=>{a[t]+=Math.floor(e*K.growthRate[t])})),Object.entries(K.skillRules.elementMap).forEach((([e,s])=>{if(s.some((e=>t.includes(e))))switch(e){case"fire":a.attack*=1.2;break;case"ice":a.defense*=1.3;break;case"poison":a.hp*=1.15}})),a})(s),skills:(t=>{const s=[];Object.entries(K.skillRules.elementMap).forEach((([e,a])=>{a.some((e=>t.includes(e)))&&s.push(`${e.toUpperCase()}系精通`)}));const n=a(t);return s.push(...K.skillRules.typeSkills[n]),e>=K.tierThresholds.advanced&&s.push("元神出窍"),[...new Set(s)]})(s),description:`散发着${s.includes("幽冥")?"阴森鬼气":"狂暴灵气"}的修真界生物`}},q=class e{static generateEnemies(t,a){const s=e.countMap[a],n=e.scale[a],r=[];for(let e=0;e<s;e++){const a=Y(t),s=new l(a.name,i.ENEMY,a.age,a.gender,o(a.level));s.ATK=Math.round(s.ATK*n),s.M_ATK=Math.round(s.M_ATK*n),s.HP=Math.round(s.HP*n),s.CURRENT_HP=Math.round(s.CURRENT_HP*n),s.MP=Math.round(s.MP*n),s.CURRENT_MP=Math.round(s.CURRENT_MP*n),s.DEF=Math.round(s.DEF*n),s.M_DEF=Math.round(s.M_DEF*n),s.SPD=Math.round((s.SPD-e)*n),s.CRIT_RATE=Math.round(parseFloat(s.CRIT_RATE)*n)+"%",s.CRIT_RATE=Math.round(parseFloat(s.CRIT_RATE)*n)+"%",r.push(s)}return r}};t(q,"countMap",{veryEasy:1,easy:2,normal:3,hard:4,boss:1}),t(q,"scale",{veryEasy:.5,easy:.8,normal:1,hard:1.2,boss:2});let G=q;const V={class:"log_view"},z=["innerHTML"],Q=f({__name:"LogView",setup(e){const t=y(null),a=y(!0);let s=!1;const n=u.LOG_LIST;N(n,(()=>{a.value&&S((()=>{i()}))}));const i=()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)},r=()=>{s||(s=!0,requestAnimationFrame((()=>{a.value=((e=5)=>{if(!t.value)return!0;const{scrollTop:a,clientHeight:s,scrollHeight:n}=t.value;return n-(a+s)<e})(),s=!1})))};b((()=>{var e;null==(e=t.value)||e.addEventListener("scroll",r)})),L((()=>{var e;null==(e=t.value)||e.removeEventListener("scroll",r)}));const l=()=>{const e=setTimeout((()=>{a.value=!0,i(),clearTimeout(e)}),350)};return(e,s)=>(g(),R("div",V,[M("div",{ref_key:"scrollContainer",ref:t,class:"scroll-container"},[(g(!0),R(C,null,x(A(n),((e,t)=>(g(),R("div",{key:t,class:"message-item",innerHTML:e},null,8,z)))),128))],512),k(H,{name:"fade-slide"},{default:D((()=>[I(M("div",{class:"back-button",onClick:l}," ↓ 返回底部 ",512),[[w,!a.value]])])),_:1})]))}}),J={class:"game_container"},W={class:"attack_list"},X={class:"attack_list"},Z={key:0,class:"box",style:{display:"flex","justify-content":"space-evenly"}},ee=f({__name:"Combat",setup(e){const t=c();let a,s=y(null),n=U([]),r=U([]),o=[],f=y(0);const E=U({}),T=()=>{w.show("数据异常，重新登录!"),t.setBackToLogin(!0),h.replace("/")},N=()=>{if(!s.value)return void T();let e=G.generateEnemies(s.value.getLevel(),"veryEasy");r=e,n.forEach((e=>{e.reset()})),o=[...n,...e],a=o.sort(((e,t)=>t.SPD-e.SPD))},H=()=>{var e,t,a,s;const l=n.every((e=>!e.CURRENT_HP)),o=r.every((e=>!e.CURRENT_HP));if(l){let a={exp:-Math.round(10*Math.random())};return m.gainAwardInfo(a),f.value=(null==(t=null==(e=m.getPlayerData())?void 0:e.assetsInfo)?void 0:t.exp)||0,u.defeated({actor:r[0],target:n[0]}),void N()}if(o){let e={exp:Math.round(10*Math.random())};return m.gainAwardInfo(e),f.value=(null==(s=null==(a=m.getPlayerData())?void 0:a.assetsInfo)?void 0:s.exp)||0,u.defeated({target:r[0],actor:n[0]}),void N()}const c=D();if(c&&c.canAct()){E[c.NAME]=c.SLIDE===i.FRIENDLY?"attack":"counterattack";const e=(c.SLIDE===i.ENEMY?n:r).filter((e=>e.CURRENT_HP)).sort(((e,t)=>e.CURRENT_HP-t.CURRENT_HP))[0];if(!c.isHitEnemy(e.getStringUnit("DODGE")))return E[e.NAME]="miss",void u.attackMiss({actor:c,target:e});if(Math.random()>.4)if(c.isHitEffect(e.getResist(v.POISONED))){const t={startCount:e.getRoundCount(),roundCount:2,state:v.POISONED,isOverlay:Math.random()>=.6,status:{DEF:-1,ATK:-1}};e.useBuffEffect(t)&&u.buffApplied({actor:c,target:e,effect:v.POISONED})}else u.buffAppliedFail({actor:c,target:e,effect:v.POISONED});else{const e={startCount:c.getRoundCount(),roundCount:2,state:v.STRENGTHEN,isOverlay:!0,status:{DEF:10,ATK:10}};let t=c.SLIDE===i.ENEMY?r:n;const a=t[Math.round(Math.random()*(t.length-1))];a.useBuffEffect(e)&&u.buffApplied({actor:c,target:a,effect:v.STRENGTHEN})}if(e){E[e.NAME]=c.SLIDE===i.FRIENDLY?"hit":"hit-counter";const t=c.getPhysicalDemage((null==e?void 0:e.getFinalDenfence())||0);e.CURRENT_HP=p(Math.round(e.CURRENT_HP-t)),u.attack({actor:c,target:e,demage:t})}let t=setTimeout((()=>{delete E[c.NAME],e&&delete E[e.NAME],clearTimeout(t)}),e?500:400);c.updateStatus()}},D=()=>{if(a.length){let e=!0;for(;e;){let t=a.shift();if(t&&(a.push(t),t.CURRENT_HP))return e=!1,t}}else;};let I=null;const w=d();b((()=>{var e,t;let i=m.getPlayerData();if(!i)return void T();const u=i.userInfo;s.value=l.fromObject(u),f.value=(null==(t=null==(e=m.getPlayerData())?void 0:e.assetsInfo)?void 0:t.exp)||0,n.push(s.value);let c=G.generateEnemies(p(Math.round(s.value.getLevel()-2)),"veryEasy");r=c,o=[...n,...c],a=o.sort(((e,t)=>t.SPD-e.SPD)),I=new j(H,550),I.start()})),L((()=>{null==I||I.end()}));const S=()=>{null==I||I.pause()},O=()=>{null==I||I.resume()};return(e,a)=>{var i;return g(),R(C,null,[M("span",null,P("已获得经验："+A(f)),1),M("span",null,P(" 当前等级："+((null==(i=A(s))?void 0:i.LEVEL)||0)),1),M("div",{class:_(["combat_view",{flex_row:A(t).mediaHelperType.gridColumns>4}])},[M("div",J,[M("div",W,[(g(!0),R(C,null,x(A(n),(e=>(g(),R("div",{class:"attack_item",key:e.NAME},[k(B,{class:_(["unit-wrapper",E[e.NAME]]),name:e.NAME,identity:e.SLIDE,"current-h-p":e.CURRENT_HP,"max-h-p":e.getNumberUnit("HP"),"current-m-p":e.CURRENT_MP,"max-m-p":e.getNumberUnit("MP")},null,8,["class","name","identity","current-h-p","max-h-p","current-m-p","max-m-p"])])))),128))]),M("div",X,[(g(!0),R(C,null,x(A(r),(e=>(g(),R("div",{class:"attack_item",key:e.NAME},[k(B,{class:_(["unit-wrapper",E[e.NAME]]),name:e.NAME,identity:e.SLIDE,"current-h-p":e.CURRENT_HP,"max-h-p":e.getNumberUnit("HP"),"current-m-p":e.CURRENT_MP,"max-m-p":e.getNumberUnit("MP"),"is-l-t-r":!0},null,8,["class","name","identity","current-h-p","max-h-p","current-m-p","max-m-p"])])))),128))])]),4===A(t).mediaHelperType.gridColumns?(g(),R("div",Z,[M("div",{class:"cancel btn",onClick:S},"暂停战斗"),M("div",{class:"start btn",onClick:O},"恢复战斗")])):F("",!0),k(Q)],2)],64)}}}),te={class:"main_page"},ae=f({__name:"CultivationView",setup:e=>(e,t)=>(g(),R("div",te,[k(ee)]))});export{ae as default};
